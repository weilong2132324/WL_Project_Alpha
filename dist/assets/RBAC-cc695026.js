import"./base-023a9467.js";import{E as pe}from"./card-7b9566ef.js";import{E as fe,a as ve}from"./radio-button-cd894692.js";import{D as H,E as Q,a as X}from"./table-column-bea08da8.js";import"./scrollbar-a6934be9.js";import"./popper-452fb29d.js";import{E as Y}from"./popover-b85e004e.js";import{E as Z}from"./overlay-427945f8.js";import{E as ee,a as le}from"./form-item-30714343.js";import{E as oe}from"./input-780273cb.js";import{E as te,a as ae}from"./select-877336ea.js";import{E as se}from"./button-a5e2a0da.js";/* empty css             */import{c as e,r as p,p as ne,z as re,o as u,a as f,f as i,w as l,u as j,h as _,F as C,b as E,d as M,L as J,t as T,M as _e,N as ue,e as be,G as ke}from"./index-ab9da3ee.js";import{r as N,E as z}from"./index-82377cc5.js";import{E as ie}from"./index-f008c14e.js";import{S as de}from"./Search-6331e9f4.js";import{E as we}from"./Edit-8d9255f3.js";import{I as Ve}from"./index-1c9e3cad.js";import"./error-78e43d3e.js";import"./_commonjsHelpers-de833af9.js";import"./isNil-c75b1b34.js";import"./focus-trap-3082f5b4.js";import"./vnode-d00f7f96.js";import"./index-ac5221b9.js";import"./axios-4a70c6fc.js";const he=Ve("list-view",!0,function(a){return e("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},[e("rect",{x:"4",y:"6",width:"40",height:"36",rx:"3",stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),e("path",{d:"M4 14H44",stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),e("path",{d:"M20 24H36",stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),e("path",{d:"M20 32H36",stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),e("path",{d:"M12 24H14",stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null),e("path",{d:"M12 32H14",stroke:a.colors[0],"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin},null)])}),ye={class:"p-4"},Ce={class:"flex flex-row w-full space-x-[2rem]"},xe=i("span",{class:"text-gray-400"},"The role name",-1),$e=i("div",{class:"py-4"},"Labels",-1),ge={class:"flex flex-row w-full space-x-[1rem] justify-center"},Re={class:"my-[1rem] text-right"},je={class:"dialog-footer"},Ee=i("div",{class:"py-4"},"Labels",-1),Ue={class:"flex flex-row w-full space-x-[1rem] justify-center"},Le={class:"my-[1rem] text-right"},Be={class:"dialog-footer"},Ae=i("p",null,"Are you sure to delete this role?",-1),Ne={class:"my-[0.5rem]"},ze={__name:"Role",setup(a){const b=p([]),V=p([]),U=p(!1),x=p(!1),h=p(-1),m=p({rules:[{}]}),r=p({}),k=p({}),y=p(),W=p(),D=p(""),G=ne(()=>b.value.filter(s=>!D.value||s.name.toLowerCase().includes(D.value.toLowerCase())));re(()=>{N.get("/api/v1/roles").then(s=>{b.value=Array.from(s.data.data)}),N.get("/api/v1/groups").then(s=>{V.value=Array.from(s.data.data)})});const v=()=>{const s=j(y);s&&s.validate((t,g)=>{t?N.post("/api/v1/roles",m.value).then(w=>{z.success("Create success"),b.value.push(w.data.data),U.value=!1}):(console.log(g),z.error("Input invalid, all fields required"))})},d=s=>{r.value=s,k.value=s,x.value=!0},I=()=>{const s=j(W);s&&s.validate((t,g)=>{t?N.put(`/api/v1/roles/${r.value.id}`,r.value).then(w=>{z.success("Update success"),_e(b,k,r.value),x.value=!1}):(console.log("Invalid update parameters",g),z.error(`Input invalid: ${g}`))})},O=s=>{N.delete(`/api/v1/roles/${s.id}`).then(()=>{z.success("Delete success"),ue(b.value,s),h.value=-1})},$=(s,t)=>{const g=s.rules.indexOf(t);g!==-1&&s.rules.splice(g,1)},F=s=>{s.rules.push({key:"",value:""})};return(s,t)=>{const g=ie,w=oe,c=se,L=ee,S=te,n=ae,R=le,P=Z,q=Q,ce=Y,me=X;return u(),f("div",ye,[i("div",Ce,[e(w,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=o=>D.value=o),placeholder:"Type to search"},{prefix:l(()=>[e(g,null,{default:l(()=>[e(j(de))]),_:1})]),_:1},8,["modelValue"]),e(c,{type:"primary",plain:"",onClick:t[1]||(t[1]=o=>U.value=!0)},{default:l(()=>[_("Create Role")]),_:1})]),e(P,{modelValue:U.value,"onUpdate:modelValue":t[7]||(t[7]=o=>U.value=o),center:"",title:"Create Role",width:"60%"},{footer:l(()=>[i("span",je,[e(c,{type:"primary",onClick:v},{default:l(()=>[_("Confirm")]),_:1}),e(c,{onClick:t[6]||(t[6]=o=>U.value=!1)},{default:l(()=>[_("Cancel")]),_:1})])]),default:l(()=>[e(R,{ref_key:"createFormRef",ref:y,model:m.value,"label-position":"left","label-width":"auto"},{default:l(()=>[e(L,{label:"Name",prop:"name",required:""},{default:l(()=>[e(w,{modelValue:m.value.name,"onUpdate:modelValue":t[2]||(t[2]=o=>m.value.name=o)},null,8,["modelValue"]),xe]),_:1}),e(L,{label:"Scope",prop:"scope",class:"w-1/2",required:""},{default:l(()=>[e(n,{class:"w-full",modelValue:m.value.scope,"onUpdate:modelValue":t[3]||(t[3]=o=>m.value.scope=o),placeholder:"please select scope"},{default:l(()=>[e(S,{label:"Cluster",value:"cluster"}),e(S,{label:"Namespace",value:"namespace"})]),_:1},8,["modelValue"])]),_:1}),e(L,{label:"Namespace",prop:"namespace",class:"w-1/2",required:m.value.scope=="namespace"},{default:l(()=>[e(n,{class:"w-full",modelValue:m.value.namespace,"onUpdate:modelValue":t[4]||(t[4]=o=>m.value.namespace=o),filterable:"",placeholder:"please select namespace",disabled:m.value.scope=="cluster"},{default:l(()=>[(u(!0),f(C,null,E(V.value,o=>(u(),M(S,{label:o.name,value:o.name,key:o.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["required"]),$e,(u(!0),f(C,null,E(m.value.rules,(o,B)=>(u(),M(L,null,{default:l(()=>[i("div",ge,[e(w,{modelValue:o.resource,"onUpdate:modelValue":A=>o.resource=A,placeholder:"resource"},null,8,["modelValue","onUpdate:modelValue"]),e(w,{modelValue:o.operation,"onUpdate:modelValue":A=>o.operation=A,placeholder:"operation"},null,8,["modelValue","onUpdate:modelValue"]),e(c,{link:"",onClick:J(A=>$(m.value,o),["prevent"]),icon:j(H)},null,8,["onClick","icon"])])]),_:2},1024))),256)),i("div",Re,[e(c,{onClick:t[5]||(t[5]=o=>F(m.value))},{default:l(()=>[_("Add")]),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(P,{modelValue:x.value,"onUpdate:modelValue":t[14]||(t[14]=o=>x.value=o),center:"",title:"Update Role",width:"33%"},{footer:l(()=>[i("span",Be,[e(c,{type:"primary",onClick:t[12]||(t[12]=o=>I())},{default:l(()=>[_("Confirm")]),_:1}),e(c,{onClick:t[13]||(t[13]=o=>x.value=!1)},{default:l(()=>[_("Cancel")]),_:1})])]),default:l(()=>[e(R,{ref_key:"updateFormRef",ref:W,model:r.value,"label-position":"left","label-width":"auto"},{default:l(()=>[e(L,{label:"Name",prop:"name",disabled:""},{default:l(()=>[e(w,{modelValue:r.value.name,"onUpdate:modelValue":t[8]||(t[8]=o=>r.value.name=o),disabled:""},null,8,["modelValue"])]),_:1}),e(L,{label:"Scope",prop:"scope",class:"w-1/2",disabled:""},{default:l(()=>[e(w,{modelValue:r.value.scope,"onUpdate:modelValue":t[9]||(t[9]=o=>r.value.scope=o),disabled:""},null,8,["modelValue"])]),_:1}),e(L,{label:"Namespace",prop:"namespace",class:"w-1/2",disabled:""},{default:l(()=>[e(w,{modelValue:r.value.namespace,"onUpdate:modelValue":t[10]||(t[10]=o=>r.value.namespace=o),disabled:""},null,8,["modelValue"])]),_:1}),Ee,(u(!0),f(C,null,E(r.value.rules,(o,B)=>(u(),M(L,null,{default:l(()=>[i("div",Ue,[e(w,{modelValue:o.resource,"onUpdate:modelValue":A=>o.resource=A,placeholder:"resource"},null,8,["modelValue","onUpdate:modelValue"]),e(w,{modelValue:o.operation,"onUpdate:modelValue":A=>o.operation=A,placeholder:"operation"},null,8,["modelValue","onUpdate:modelValue"]),e(c,{link:"",onClick:J(A=>$(r.value,o),["prevent"]),icon:j(H),type:"danger"},null,8,["onClick","icon"])])]),_:2},1024))),256)),i("div",Le,[e(c,{onClick:t[11]||(t[11]=o=>F(r.value))},{default:l(()=>[_("Add")]),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(me,{data:G.value,class:"w-full mt-[0.75rem]"},{default:l(()=>[e(q,{prop:"name",label:"Name",sortable:""}),e(q,{prop:"scope",label:"Scope"}),e(q,{prop:"namespace",label:"Namespace"}),e(q,{prop:"rules",label:"Rules"},{default:l(()=>[e(q,{label:"Resource"},{default:l(o=>[(u(!0),f(C,null,E(o.row.rules,B=>(u(),f("div",null,T(B.resource),1))),256))]),_:1}),e(q,{label:"Operation"},{default:l(o=>[(u(!0),f(C,null,E(o.row.rules,B=>(u(),f("div",null,T(B.operation),1))),256))]),_:1})]),_:1}),e(q,{label:"Operation"},{default:l(o=>[e(c,{size:"small",circle:"",onClick:B=>d(o.row),icon:j(we)},null,8,["onClick","icon"]),e(ce,{visible:h.value==o.$index,placement:"top",width:180},{reference:l(()=>[e(c,{size:"small",type:"danger",onClick:B=>h.value=o.$index,icon:j(H),circle:"",class:"wl-[1rem]"},null,8,["onClick","icon"])]),default:l(()=>[Ae,i("div",Ne,[e(c,{size:"small",text:"",onClick:t[15]||(t[15]=B=>h.value=-1)},{default:l(()=>[_("cancel")]),_:1}),e(c,{size:"small",type:"danger",onClick:B=>O(o.row)},{default:l(()=>[_("confirm")]),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:1})]),_:1},8,["data"])])}}},Ie={class:"p-4"},Fe={class:"flex flex-row w-full space-x-[2rem]"},qe={class:"dialog-footer"},De=i("p",null,"Are you sure to delete this role binding?",-1),Me={class:"my-[0.5rem]"},K={__name:"RoleBinding",props:{resource:{type:String},subject:{type:String}},setup(a){const b=a,V=p([]),U=p([]),x=p([]),h=p(!1),m=p(-1),r=p({}),k=p(),y=p(""),W=ne(()=>V.value.filter(v=>!y.value||v.name.toLowerCase().includes(y.value.toLowerCase())));re(()=>{N.get(`/api/v1/${b.resource}`).then(v=>{x.value=Array.from(v.data.data);for(let d of Array.from(v.data.data))for(let I of Array.from(d.roles))V.value.push({subject:d,role:I})}),N.get("/api/v1/roles").then(v=>{U.value=Array.from(v.data.data)})});const D=()=>{const v=j(k);v&&v.validate((d,I)=>{d?N.post(`/api/v1/${b.resource}/${r.value.subject}/roles/${r.value.role}`).then(O=>{z.success("Create success");let $=V.value.find(s=>s.subject.id==r.value.subject).subject,F=U.value.find(s=>s.id==r.value.role);V.value.push({subject:$,role:F}),h.value=!1}):(console.log(I),z.error("Input invalid, all fields required"))})},G=v=>{N.delete(`/api/v1/${b.resource}/${v.subject.id}/roles/${v.role.id}`).then(()=>{z.success("Delete success"),ue(V.value,v),m.value=-1})};return(v,d)=>{const I=ie,O=oe,$=se,F=te,s=ae,t=ee,g=le,w=Z,c=Q,L=Y,S=X;return u(),f("div",Ie,[i("div",Fe,[e(O,{modelValue:y.value,"onUpdate:modelValue":d[0]||(d[0]=n=>y.value=n),placeholder:"Type to search"},{prefix:l(()=>[e(I,null,{default:l(()=>[e(j(de))]),_:1})]),_:1},8,["modelValue"]),e($,{type:"primary",plain:"",onClick:d[1]||(d[1]=n=>h.value=!0)},{default:l(()=>[_("Create RoleBinding")]),_:1})]),e(w,{modelValue:h.value,"onUpdate:modelValue":d[5]||(d[5]=n=>h.value=n),center:"",title:"Create RoleBinding",width:"30rem"},{footer:l(()=>[i("span",qe,[e($,{type:"primary",onClick:D},{default:l(()=>[_("Confirm")]),_:1}),e($,{onClick:d[4]||(d[4]=n=>h.value=!1)},{default:l(()=>[_("Cancel")]),_:1})])]),default:l(()=>[e(g,{ref_key:"createFormRef",ref:k,model:r.value,"label-position":"left","label-width":"auto"},{default:l(()=>[e(t,{label:b.subject,prop:"subject",required:""},{default:l(()=>[e(s,{class:"w-full",modelValue:r.value.subject,"onUpdate:modelValue":d[2]||(d[2]=n=>r.value.subject=n),filterable:"",placeholder:"please select subject"},{default:l(()=>[(u(!0),f(C,null,E(x.value,n=>(u(),M(F,{label:n.name,value:n.id,key:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(t,{label:"Role",prop:"role",required:""},{default:l(()=>[e(s,{class:"w-full",modelValue:r.value.role,"onUpdate:modelValue":d[3]||(d[3]=n=>r.value.role=n),filterable:"",placeholder:"please select role"},{default:l(()=>[(u(!0),f(C,null,E(U.value,n=>(u(),M(F,{label:n.name,value:n.id,key:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(S,{data:W.value,class:"w-full mt-[0.75rem]"},{default:l(()=>[e(c,{prop:"subject.name",label:b.subject,sortable:""},null,8,["label"]),e(c,{prop:"role.name",label:"Role"}),e(c,{prop:"role.namespace",label:"RoleNamespace"}),e(c,{prop:"role.rules",label:"Rules"},{default:l(()=>[e(c,{label:"Resource"},{default:l(n=>[(u(!0),f(C,null,E(n.row.role.rules,R=>(u(),f("div",{key:R},T(R.resource),1))),128))]),_:1}),e(c,{label:"Operation"},{default:l(n=>[(u(!0),f(C,null,E(n.row.role.rules,R=>(u(),f("div",{key:R},T(R.operation),1))),128))]),_:1})]),_:1}),e(c,{label:"Operation"},{default:l(n=>[e(L,{visible:m.value==n.$index,placement:"top",width:180},{reference:l(()=>[e($,{size:"small",type:"danger",onClick:R=>m.value=n.$index,icon:j(H),circle:"",class:"wl-[1rem]"},null,8,["onClick","icon"])]),default:l(()=>[De,i("div",Me,[e($,{size:"small",text:"",onClick:d[6]||(d[6]=R=>m.value=-1)},{default:l(()=>[_("cancel")]),_:1}),e($,{size:"small",type:"danger",onClick:R=>G(n.row)},{default:l(()=>[_("confirm")]),_:2},1032,["onClick"])])]),_:2},1032,["visible"])]),_:1})]),_:1},8,["data"])])}}},Se={class:"w-full justify-center"},Te={class:"flex flex-col h-full px-[4rem] py-[2rem] space-y-[1rem]"},We={class:"flex flex-col overflow-hidden rounded-md shadow-md border"},Oe={class:"flex w-full h-[5rem] items-center"},He=i("span",{class:"m-[0.75rem] text-2xl font-600"},"RBAC Policies",-1),Ge={class:"flex h-[3rem] items-center pl-[1rem] bg-slate-100"},Pe={class:"flex flex-col w-full"},Vl={__name:"RBAC",setup(a){const b=[{name:"Roles",component:ze},{name:"GroupRoleBinding",component:K,resource:"groups",subject:"Group"},{name:"UserRoleBinding",component:K,resource:"users",subject:"User"}],V=p(0);return(U,x)=>{const h=ve,m=fe,r=pe;return u(),f("div",Se,[i("div",Te,[i("div",We,[i("div",Oe,[e(j(he),{class:"ml-[1rem]",theme:"filled",size:"42",fill:"#94A3B8"}),He]),i("div",Ge,[e(m,{modelValue:V.value,"onUpdate:modelValue":x[0]||(x[0]=k=>V.value=k)},{default:l(()=>[(u(),f(C,null,E(b,(k,y)=>e(h,{plain:"",label:y,key:k},{default:l(()=>[_(T(k.name),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])]),e(r,{class:"h-max w-full"},{default:l(()=>[i("div",Pe,[(u(),f(C,null,E(b,(k,y)=>(u(),f(C,null,[V.value==y?(u(),M(be(k.component),{key:y,resource:k.resource,subject:k.subject},null,8,["resource","subject"])):ke("",!0)],64))),64))])]),_:1})])])}}};export{Vl as default};
