import"./base-023a9467.js";import{E as z}from"./button-a5e2a0da.js";import{a as N,E as S}from"./form-item-30714343.js";import{E as W}from"./input-780273cb.js";import{_ as G}from"./weave-b1bb531c.js";import{r as I,E as k}from"./index-82377cc5.js";import{c as t,_ as P,O as R,r as w,R as v,o as C,a as $,f as m,w as i,G as M,u as _,h,ab as B,ac as F}from"./index-ab9da3ee.js";import{a as f}from"./config-7d1d600a.js";import{I as y}from"./index-1c9e3cad.js";import{E as q}from"./index-47df7860.js";import{U as Z}from"./User-c5a1d84a.js";import{G as A}from"./Github-3e4c2c7c.js";import"./index-f008c14e.js";import"./error-78e43d3e.js";import"./isNil-c75b1b34.js";import"./axios-4a70c6fc.js";const H=y("lock",!1,function(e){return t("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[t("rect",{x:"6",y:"22",width:"36",height:"22",rx:"2",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M14 22V14C14 8.47715 18.4772 4 24 4C29.5228 4 34 8.47715 34 14V22",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M24 30V36",stroke:e.colors[2],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null)])}),O=y("wechat",!0,function(e){return t("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M36.9974 21.7112C36.8434 13.0079 29.7401 6 21 6C12.1634 6 5 13.1634 5 22C5 26.1701 6.59531 29.9676 9.20892 32.8154L8.01043 40.0257L15.125 36.9699C18.2597 38.0122 21.218 38.2728 24 37.7516",fill:e.colors[1]},null),t("path",{d:"M36.9974 21.7112C36.8434 13.0079 29.7401 6 21 6C12.1634 6 5 13.1634 5 22C5 26.1701 6.59531 29.9676 9.20892 32.8154L8.01043 40.0257L15.125 36.9699C18.2597 38.0122 21.218 38.2728 24 37.7516",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M15.125 20.4667C16.3676 20.4667 17.375 19.4519 17.375 18.2C17.375 16.9482 16.3676 15.9333 15.125 15.9333C13.8824 15.9333 12.875 16.9482 12.875 18.2C12.875 19.4519 13.8824 20.4667 15.125 20.4667Z",fill:e.colors[2]},null),t("path",{d:"M24.125 20.4667C25.3676 20.4667 26.375 19.4519 26.375 18.2C26.375 16.9482 25.3676 15.9333 24.125 15.9333C22.8824 15.9333 21.875 16.9482 21.875 18.2C21.875 19.4519 22.8824 20.4667 24.125 20.4667Z",fill:e.colors[2]},null),t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M38.7618 39.9293C37.0135 41.2302 34.8467 42 32.5 42C26.701 42 22 37.299 22 31.5C22 25.701 26.701 21 32.5 21C38.299 21 43 25.701 43 31.5C43 33.0997 42.6423 34.6159 42.0024 35.9728",fill:e.colors[1]},null),t("path",{d:"M38.7618 39.9293C37.0135 41.2302 34.8467 42 32.5 42C26.701 42 22 37.299 22 31.5C22 25.701 26.701 21 32.5 21C38.299 21 43 25.701 43 31.5C43 33.0997 42.6423 34.6159 42.0024 35.9728",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M42.0024 35.9728L43 42L38.7618 39.9293",fill:e.colors[1]},null),t("path",{d:"M42.0024 35.9728L43 42L38.7618 39.9293",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M35.6875 30.7999C34.7555 30.7999 34 30.0388 34 29.0999C34 28.161 34.7555 27.3999 35.6875 27.3999C36.6195 27.3999 37.375 28.161 37.375 29.0999C37.375 30.0388 36.6195 30.7999 35.6875 30.7999Z",fill:e.colors[2]},null),t("path",{d:"M28.9375 30.7999C28.0055 30.7999 27.25 30.0388 27.25 29.0999C27.25 28.161 28.0055 27.3999 28.9375 27.3999C29.8695 27.3999 30.625 28.161 30.625 29.0999C30.625 30.0388 29.8695 30.7999 28.9375 30.7999Z",fill:e.colors[2]},null)])});const D=e=>(B("data-v-d9763d3c"),e=e(),F(),e),J={class:"h-full login-bg bg-slate-50"},K={class:"flex h-full justify-center items-center"},Q={class:"h-max min-w-[16rem] w-1/4 max-w-[24rem] text-center items-center"},X=D(()=>m("div",{class:"inline-flex mt-4 mb-8 items-center"},[m("img",{src:G,class:"h-12 mr-2"}),m("h1",{class:"font-bold text-4xl font-mono"},"Weave")],-1)),Y={key:0},T={class:"w-full flex mt-[0.25rem]"},ee={class:"w-full text-right"},te={class:"my-[0.5rem]"},oe={key:1},le={class:"mt-[0.25rem] text-right"},se={__name:"Login",setup(e){const E=R(),L=w(),b=w(),p=window.location.origin+"/oauth",g=w(!0),u=v({name:"admin",password:"123456"}),r=v({name:"",email:"",password:""}),x=v({name:[{required:!0,message:"Please input user name",trigger:"blur"}],password:[{required:!0,message:"Please input password",trigger:"blur"},{min:6,message:"Length should be great than 6",trigger:"blur"}],email:[{required:!0,message:"Please input email",trigger:"blur"},{type:"email",message:"Please input correct email address",trigger:["blur","change"]}]}),j=async l=>{if(!l)return;let o=u.name,n=function(){q.success({title:"Login Success",message:"Hi~ "+o,showClose:!0,duration:1500}),E.push("/")};await l.validate((a,c)=>{a?I.post("/api/v1/auth/token",{name:u.name,password:u.password,setCookie:!0}).then(d=>{n()}):(console.log("input invaild",c),k({message:"Input invalid"+c,type:"error"}))})},V=l=>{if(!f[l])return;let o="";const n=f[l].endpoint,a=f[l].scope,c=f[l].clientId,d=btoa(`${window.location.search}&app=weave&oauth=${l}`);if(l==="google")o=`${n}?client_id=${c}&redirect_uri=${p}&scope=${a}&response_type=code&state=${d}`;else if(l==="github")o=`${n}?client_id=${c}&redirect_uri=${p}&scope=${a}&response_type=code&state=${d}`;else if(l==="wechat")navigator.userAgent.includes("MicroMessenger")?o=`${f[l].mpEndpoint}?appid=${f[l].clientId2}&redirect_uri=${p}&state=${d}&scope=${f[l].mpScope}&response_type=code#wechat_redirect`:o=`${n}?appid=${c}&redirect_uri=${p}&scope=${a}&response_type=code&state=${d}#wechat_redirect`;else{console.log(`auth type ${l} not supported`);return}window.location.href=o},U=async l=>{l&&await l.validate((o,n)=>{o?I.post("/api/v1/auth/user",{name:r.name,password:r.password,email:r.email}).then(a=>{k({message:"Register success",type:"success"}),u.name=r.name,u.password=r.password,activeTab.value="login"}):(console.log("Input invalid =>",n),k({message:"Input invalid",type:"error"}))})};return(l,o)=>{const n=W,a=S,c=N,d=z;return C(),$("div",J,[m("div",K,[m("div",Q,[X,g.value?(C(),$("div",Y,[t(c,{ref_key:"loginFormRef",ref:L,model:u,size:"large",rules:x,"show-message":""},{default:i(()=>[t(a,{prop:"name"},{default:i(()=>[t(n,{modelValue:u.name,"onUpdate:modelValue":o[0]||(o[0]=s=>u.name=s),placeholder:"admin"},{prefix:i(()=>[t(_(Z))]),_:1},8,["modelValue"])]),_:1}),t(a,{prop:"password"},{default:i(()=>[t(n,{modelValue:u.password,"onUpdate:modelValue":o[1]||(o[1]=s=>u.password=s),type:"password",placeholder:"123456","show-password":""},{prefix:i(()=>[t(_(H))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(d,{class:"w-full",type:"primary",size:"large",onClick:o[2]||(o[2]=s=>j(L.value))},{default:i(()=>[h("SIGN IN")]),_:1}),m("div",T,[m("div",ee,[t(d,{link:"",onClick:o[3]||(o[3]=s=>g.value=!1)},{default:i(()=>[h("SIGN UP")]),_:1})])]),m("div",te,[t(d,{link:"",onClick:o[4]||(o[4]=s=>V("github"))},{default:i(()=>[t(_(A),{theme:"outline",size:"30",fill:"#333"})]),_:1}),t(d,{link:"",onClick:o[5]||(o[5]=s=>V("wechat"))},{default:i(()=>[t(_(O),{theme:"filled",size:"30",fill:"#7ed321"})]),_:1})])])):M("",!0),g.value==!1?(C(),$("div",oe,[t(c,{ref_key:"registerFormRef",ref:b,model:r,"label-position":"top",rules:x,"label-width":"auto",size:"large"},{default:i(()=>[t(a,{label:"Username",prop:"name"},{default:i(()=>[t(n,{placeholder:"user name",modelValue:r.name,"onUpdate:modelValue":o[6]||(o[6]=s=>r.name=s),size:"large"},null,8,["modelValue"])]),_:1}),t(a,{label:"Email",prop:"email"},{default:i(()=>[t(n,{placeholder:"email",modelValue:r.email,"onUpdate:modelValue":o[7]||(o[7]=s=>r.email=s)},null,8,["modelValue"])]),_:1}),t(a,{label:"Password",prop:"password"},{default:i(()=>[t(n,{placeholder:"password",minlength:"6",modelValue:r.password,"onUpdate:modelValue":o[8]||(o[8]=s=>r.password=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),t(d,{class:"w-full",type:"primary",size:"large",onClick:o[9]||(o[9]=s=>U(b.value))},{default:i(()=>[h("SIGN UP")]),_:1}),m("div",le,[t(d,{link:"",onClick:o[10]||(o[10]=s=>g.value=!0)},{default:i(()=>[h("SIGN IN")]),_:1})])])):M("",!0)])])])}}},Ce=P(se,[["__scopeId","data-v-d9763d3c"]]);export{Ce as default};
